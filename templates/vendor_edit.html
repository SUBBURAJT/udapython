{% extends 'partials/base.html' %}
{% load static %}

{% block extra_css %}


<link href="{% static 'libs/select2/css/select2.min.css' %}" rel="stylesheet" type="text/css">

<link href="{% static 'libs/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet">

<!-- Sweet Alert-->
<link href="{% static 'libs/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css" />
<style>
    .err {
        border-color: #ff3d60 !important;
        background-image: none !important;
    }
</style>
{% endblock extra_css %}
{% block content %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">

                <form class='needs-validation' name="vendor_form" id="vendor_form" novalidate>
                    {% csrf_token %}
                    <input type="hidden" name="hdn_vendor_id" id="hdn_vendor_id" value="{{vendor.id}}" />
                    <div class="row">
                        <div class="col-12">
                            <h4 class='fw-600 mb-2 headerFall'>YOUR PERSONAL INFO</h4>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Company Name</label>
                                <input type="text" name="company_name" id="company_name" class="form-control" placeholder='Enter company name' value="{{vendor.company_name}}">
                                <div class="invalid-feedback">Company name is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">First Name <span
                                        class='text-danger'>*</span></label>
                                <input type="text" class="form-control" name="first_name" id="first_name" placeholder='Enter first name'  value="{{vendor.first_name}}" required>
                                <div class="invalid-feedback">First name is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Last Name <span class='text-danger'>*</span></label>
                                <input type="text" name="last_name" id="last_name" class="form-control" placeholder='Enter last name' value="{{vendor.last_name}}" required>
                                <div class="invalid-feedback">Last name is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Phone <span class='text-danger'>*</span></label>
                                <input type="text" name="phone" id="phone" class="form-control" placeholder='Enter phone number' value="{{vendor.phone}}"  required>
                                <div class="invalid-feedback">Phone number is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Email <span class='text-danger'>*</span></label>
                                <input type="text" name="email" id="email" class="form-control" placeholder='Enter email address' value="{{vendor.email}}" required>
                                <div class="invalid-feedback">Email is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Address <span class='text-danger'>*</span></label>
                                <input type="text" name="address" id="address" class="form-control" placeholder='Enter address' value="{{vendor.address}}" required>
                                <div class="invalid-feedback">Address is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">City <span class='text-danger'>*</span></label>
                                <input type="text" name="city" id="city" class="form-control" placeholder='Enter city' value="{{vendor.city}}" required>
                                <div class="invalid-feedback">City is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">State <span class='text-danger'>*</span></label>
                                <input type="text" name="state" id="state" class="form-control" placeholder='Enter state' value="{{vendor.state}}" required>
                                <div class="invalid-feedback">State is required</div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-label mt-3 mt-0">Zip <span class='text-danger'>*</span></label>
                                <input type="text" name="zip" id="zip" class="form-control" placeholder='Enter zipcode' value="{{vendor.zipcode}}" required>
                                <div class="invalid-feedback">Zip is required</div>
                            </div>
                        </div>

                        <div class="col-12 mt-3">
                            <div class='bg-primary-transparent p-4 ps-0 br-5'>
                                <h6 class='fw-600 text-uppercase mb-3'>Notes</h6>
                                <ul class='list-group ps-4'>
                                    <li class="py-1">Sorry no refunds will be made.
                                    </li>
                                    <li class="py-1">Staff does not need to register with a dentist. Guests need to be
                                        registered with a dentist.</li>
                                    <li class="py-1">The deadline for all pre-registration is March 13, 2020, after this
                                        date all registration must be done onsite at the Salt Palace Convention Center.
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-12 text-end">
                            <button type='reset' name="reset_frm" id="reset_frm" class="btn btn-light px-md-5 me-2">Reset All</button>
                            <button class="btn btn-primary px-md-5" type='submit' name="register_frm" id="register_frm">Proceed</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>
<!-- end row -->

{% endblock content %}

{% block extra_javascript %}

<!-- Sweet Alerts js -->
<script src="{% static 'libs/sweetalert2/sweetalert2.min.js' %}"></script>


<script src="{% static 'libs/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}"></script>

<!-- Form validation -->
<script src="{% static 'js/pages/form-validation.init.js' %}"></script>

<!-- jquery.inputmask.bundle.js -->
<script src="{% static 'js/plugins/jquery.inputmask.bundle.js' %}"></script>

<script src="{% static 'libs/select2/js/select2.min.js' %}"></script>

<script>
    $(document).ready(function () {
        $('#phone').inputmask("(999) 999-9999");
        $('.select2').select2()
        $("#email").change(function(){
            var email = $(this).val();
            var id = $("#hdn_vendor_id").val();
            if (email !='') {
                if(IsEmail(email) == false){
                    $(this).addClass('err');
                    $(this).closest('div').find('.invalid-feedback').html('Invalid Email');
                    $(this).closest('div').find('.invalid-feedback').css('display', 'block');
                }else {
                    $(this).removeClass('err');
                    $(this).closest('div').find('.invalid-feedback').css('display', 'none');
                    $.ajax({
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        url: "{% url 'vendor_email_check' %}",
                        type: "POST",
                        data: {
                            email: email,
                            id: id
                        },
                        success: function(data) {
                            if (data['err'] == 1) {
                                $("#email").addClass('err');
                                $("#email").closest('div').find('.invalid-feedback').html(data['msg']);
                                $("#email").closest('div').find('.invalid-feedback').css('display', 'block');
                            } else {
                                $("#email").removeClass('err');
                                $("#email").closest('div').find('.invalid-feedback').html("Email is required");
                                $("#email").closest('div').find('.invalid-feedback').css('display', 'none');
                            }
                        },
                        error: function() {}
                    });
                }                        
            }else{
                $(this).addClass('err');
                $(this).closest('div').find('.invalid-feedback').html('Email is required');
                $(this).closest('div').find('.invalid-feedback').css('display', 'block');
            }
        });
        $("#register_frm").click(function(e){
            var err = 0
            var fname = $("#first_name").val();
            var lname = $("#last_name").val();
            var phone = $("#phone").val();
            var email = $("#email").val();
            var addr = $("#address").val();
            var city = $("#city").val();
            var state = $("#state").val();
            var zip = $("#zip").val();
            var id = $("#hdn_vendor_id").val();
            if (email !='') {
                if(IsEmail(email) == false){
                    $(this).addClass('err');
                    $(this).closest('div').find('.invalid-feedback').html('Invalid Email');
                    $(this).closest('div').find('.invalid-feedback').css('display', 'block');
                    err++;
                }else {
                    $(this).removeClass('err');
                    $(this).closest('div').find('.invalid-feedback').css('display', 'none');
                }                        
            }else{
                $(this).addClass('err');
                $(this).closest('div').find('.invalid-feedback').html('Email is required');
                $(this).closest('div').find('.invalid-feedback').css('display', 'block');
                err++;
            }
            if(fname != '' && lname !='' && phone != '' && email !='' && addr != '' && city !='' && state != '' && zip !='' && err ==0){
                e.preventDefault();
                my_form = $("#vendor_form")[0];
                data = new FormData(my_form);
                $("#preloader").prop("display", "block");
                $.ajax({
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    url: "/vendor_edit/"+id,
                    type: "POST",
                    data: data,
                    processData: false,
                    contentType: false,
                    success: function(data) {
                        $("#preloader").prop("display", "none");
                        if (data['err'] == 0) {
                            swal.fire({
                                title: 'Success',
                                html: data['msg'],
                                icon: 'success',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            }).then((result) => {
                                location.href = "{% url 'exhibitor_registration' %}"
                            });
                        } else {
                            swal.fire({
                                title: 'Error',
                                text: data['msg'],
                                icon: 'error',
                                confirmButtonColor: '#3085d6',
                                confirmButtonText: 'Ok'
                            });
                        }
                    },
                    error: function() {}
                });
            } else {
                e.preventDefault()
                return false;
            }
        })
    })
    function IsEmail(email) {
        var regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if (!regex.test(email))
            return false;
        else
            return true;
    }

</script>

{% endblock extra_javascript %}